const inputs=document.querySelectorAll("input");function addcl(){this.parentNode.parentNode.classList.add("focus")}function remcl(){let e=this.parentNode.parentNode;""==this.value&&e.classList.remove("focus")}inputs.forEach(e=>{e.addEventListener("focus",addcl),e.addEventListener("blur",remcl)});const cita={id:"",nombre:"",fecha:"",hora:"",servicios:[]};let numeroTab=1,pasoInicial=1,pasoFinal=3;function iniciarApp(){tabs(),paginadores(),paginaAnterior(),paginaSiguiente(),consultarAPI(),obtenerIdUsuario(),obtenerUsuario(),obtenerFecha(),obtenerHora(),obtenerResumen()}function tabs(){document.querySelectorAll(".tab_titulo").forEach(e=>{e.addEventListener("click",t=>{numeroTab=parseInt(e.getAttribute("data-tab")),mostrarContenidoTab(),paginadores()})})}function mostrarContenidoTab(){const e=document.querySelector(`[data-tab="${numeroTab}"]`),t=document.querySelector("#content-"+numeroTab),n=document.querySelectorAll(".tab_content"),a=document.querySelectorAll(".tab_titulo");n.forEach(e=>e.classList.remove("active")),a.forEach(e=>e.classList.remove("active")),t.classList.add("active"),e.classList.add("active")}function paginadores(){const e=document.querySelector("#anterior"),t=document.querySelector("#siguiente");1===numeroTab?e.classList.add("inactive"):3===numeroTab?(e.classList.remove("inactive"),t.classList.add("inactive"),obtenerResumen()):(e.classList.remove("inactive"),t.classList.remove("inactive")),mostrarContenidoTab()}function paginaAnterior(){document.querySelector("#anterior").addEventListener("click",(function(){numeroTab<=pasoInicial||(numeroTab--,paginadores())}))}function paginaSiguiente(){document.querySelector("#siguiente").addEventListener("click",(function(){numeroTab>=pasoFinal||(numeroTab++,paginadores())}))}async function consultarAPI(){try{const e="http://appcitas.test/servicios",t=await fetch(e);mostrarServicios(await t.json())}catch(e){console.log(e)}}function mostrarServicios(e){e.forEach(e=>{const{id:t,nombre_servicio:n,precio_servicio:a}=e,o=document.getElementById("servicios"),i=document.createElement("P");i.classList.add("nombre-servicio"),i.textContent=n;const c=document.createElement("P");c.classList.add("precio-servicio"),c.textContent=`$ ${a}.00`;const r=document.createElement("DIV");r.classList.add("servicio"),r.appendChild(i),r.appendChild(c),r.setAttribute("data-id",t),r.onclick=function(){seleccionarServicio(e)},o.appendChild(r)})}function seleccionarServicio(e){const{id:t,nombreServicio:n,precio_servicio:a}=e,{servicios:o}=cita,i=document.querySelector(`[data-id="${t}"]`);o.some(e=>e.id==t)?(i.classList.remove("seleccionado"),cita.servicios=o.filter(e=>e.id!=t)):(i.classList.add("seleccionado"),cita.servicios=[...o,e])}function obtenerUsuario(){cita.nombre=document.getElementById("usuarioCita").value}function obtenerIdUsuario(){cita.id=document.getElementById("idUsuario").value}function obtenerFecha(){document.getElementById("fechaCita").addEventListener("input",(function(e){const t=new Date(e.target.value).getUTCDay();[0,6].includes(t)?(e.target.value="",mostrarAlerta("Fines de semana no disponible","error",".tabs_contents")):cita.fecha=e.target.value}))}function obtenerHora(){document.getElementById("horaCita").addEventListener("input",(function(e){const t=e.target.value.split(":")[0];t<10||t>18?(e.target.value="",mostrarAlerta("Horario no disponible","error",".tabs_contents")):cita.hora=e.target.value}))}function mostrarAlerta(e,t,n){const a=document.createElement("DIV"),o=document.querySelector(""+n),i=document.querySelector(".alertas");i&&i.remove(),a.textContent=e,a.classList.add("alertas"),a.classList.add(t),o.appendChild(a),setTimeout(()=>{a.remove()},4e3)}function obtenerResumen(){const e=document.querySelector(".contenido-resumen");for(;e.firstChild;)e.removeChild(e.firstChild);if(Object.values(cita).includes("")||0==cita.servicios.length)return void mostrarAlerta("Falto incluir un dato","error",".resumen");const t=document.createElement("H3");t.textContent="Servicios seleccionados",e.appendChild(t);const{nombre:n,fecha:a,hora:o,servicios:i}=cita,c=new Date(a),r=c.getMonth(),s=c.getDate()+2,d=c.getFullYear(),l=new Date(Date.UTC(d,r,s)).toLocaleDateString("es-MX",{weekday:"long",year:"numeric",month:"long",day:"numeric"});i.forEach(t=>{const{id:n,nombre_servicio:a,precio_servicio:o}=t,i=document.createElement("DIV"),c=document.createElement("P"),r=document.createElement("P");c.textContent=a,r.textContent="$ "+o,i.classList.add("resumen-servicio"),c.classList.add("nombre-servicio"),r.classList.add("precio-servicio"),i.appendChild(c),i.appendChild(r),e.appendChild(i)});const u=document.createElement("H3");u.textContent="Datos ingresados",e.appendChild(u);const m=document.createElement("DIV"),p=document.createElement("P"),v=document.createElement("P"),b=document.createElement("P"),h=document.createElement("BUTTON");m.classList.add("resumen-servicio"),p.classList.add("nombre-servicio"),v.classList.add("nombre-servicio"),b.classList.add("nombre-servicio"),h.classList.add("boton"),p.innerHTML="<span>Nombre: </span>"+n,v.innerHTML="<span>Fecha: </span>"+l,b.innerHTML="<span>Hora: </span>"+o,h.textContent="Reservar Cita",h.onclick=reservarCita,m.appendChild(p),m.appendChild(v),m.appendChild(b),e.appendChild(m),e.appendChild(h)}async function reservarCita(){try{const{id:e,nombre:t,fecha:n,hora:a,servicios:o}=cita,i=o.map(e=>e.id),c=new FormData;c.append("id_usuarioFK",e),c.append("servicios",i),c.append("fecha_cita",n),c.append("hora_cita",a);const r="http://appcitas.test/servicios/crear-cita",s=await fetch(r,{method:"POST",body:c});(await s.json()).resultado&&Swal.fire({icon:"success",title:"¡Cita Creada!",text:"La cita fue creada con éxito"}).then(()=>{setTimeout(()=>{window.location.reload()},3e3)})}catch(e){Swal.fire({icon:"error",title:"Oops...",text:"La cita no se pudo crear"})}}document.addEventListener("DOMContentLoaded",(function(){iniciarApp()}));